"use strict";var E=Object.create;var a=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var D=(t,e)=>{for(var o in e)a(t,o,{get:e[o],enumerable:!0})},R=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of v(e))!A.call(t,r)&&r!==o&&a(t,r,{get:()=>e[r],enumerable:!(n=N(e,r))||n.enumerable});return t};var i=(t,e,o)=>(o=t!=null?E(P(t)):{},R(e||!t||!t.__esModule?a(o,"default",{value:t,enumerable:!0}):o,t)),O=t=>R(a({},"__esModule",{value:!0}),t);var M={};D(M,{default:()=>g});module.exports=O(M);var k=i(require("fs-extra"));var h=require("debug"),W=i(require("fs-extra")),c=(0,h.debug)("currents");var S=i(require("crypto"));var _=i(require("fs-extra")),u=i(require("path"));function b(t,e){return $(u.default.relative(e,t))}function $(t){return t.split(u.default.sep).join(u.default.posix.sep)}function w(){return"root"}function C(t){return t.context.config.displayName?.name??t.context.config.id}function m(t){return[...t.ancestorTitles,t.title]}function d(t){return b(t.path,t.context.config.rootDir)}function y(t,e){let o=m(e),n=d(t),r=o.join(" ")+n;return S.default.createHash("sha256").update(r).digest("hex").substring(0,16)}var H=[];function I(t){H.push(t)}var s=i(require("chalk")),x=i(require("util"));var j=[];var L=(...t)=>{let e=x.default.format(...t);I(e),console.log(e)};var F=(...t)=>{let e=x.default.format(...t);return j.push(e),c("ERROR: ",e),L(s.default.bgRed.white(" ERROR "),e)};var it=s.default.cyan,lt=s.default.blueBright,at=s.default.red,ct=s.default.yellow,ut=s.default.green,pt=s.default.gray,gt=s.default.white,ft=s.default.black,mt=s.default.magenta,T=s.default.dim,dt=s.default.bold;var p=c.extend("jest-discovery"),g=class{constructor(){this.specsWitoutResultsCount=0;this.fullTestSuite={}}onRunStart(e){p("onRunStart, results: %O",e),console.time(T("@currents/jest-discovery"))}onTestFileResult(e,o){let n=C(e);this.fullTestSuite[n]||(this.fullTestSuite[n]={name:n,tags:[],tests:[]});let r=d(e);p("onTestFileResult [%s][%s]",n,r),o.testResults.length===0?(p("Failed to obtain spec results, error:",r,o.failureMessage),this.specsWitoutResultsCount+=1):this.fullTestSuite[n].tests.push(...o.testResults.map(f=>({spec:r,tags:[],testId:y(e,f),title:m(f)})))}async onRunComplete(e,o){let n=process.env.CURRENTS_DISCOVERY_PATH;if(!n)throw new Error("CURRENTS_DISCOVERY_PATH is not set");let r=[];this.specsWitoutResultsCount>0?F("Incomplete full test suite! Run the command with --debug flag."):(r=this.getFullTestSuite(e),p("onRunComplete %s, %o",n,r)),await k.default.writeFile(n,JSON.stringify(r),"utf8"),console.timeEnd(T("@currents/jest-discovery"))}getFullTestSuite(e){let o=Object.values(this.fullTestSuite),n=o.length===1,r=o.length>0&&e.size>0&&[...e][0].config.id===o[0].name;return n&&r&&(o[0].name=w()),o}};
/*! For license information please see reporter.js.LEGAL.txt */
//# sourceMappingURL=reporter.js.map